---

title: cryptotree

keywords: fastai
sidebar: home_sidebar

summary: "Homomorphic implementations of neural decisions trees."
description: "Homomorphic implementations of neural decisions trees."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/05_cryptotree.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Homomorphic-trees">Homomorphic trees<a class="anchor-link" href="#Homomorphic-trees"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="to_list_and_duplicate" class="doc_header"><code>to_list_and_duplicate</code><a href="https://github.com/dhuynh95/cryptotree/tree/master/cryptotree/cryptotree.py#L20" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>to_list_and_duplicate</code>(<strong><code>array</code></strong>)</p>
</blockquote>
<p>Takes an array, append a 0 then copies itself once more.</p>
<p>This step is necessary to do matrix multiplication with Galois rotations.
This is used on the bias of the comparator.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="to_list_and_pad" class="doc_header"><code>to_list_and_pad</code><a href="https://github.com/dhuynh95/cryptotree/tree/master/cryptotree/cryptotree.py#L30" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>to_list_and_pad</code>(<strong><code>array</code></strong>)</p>
</blockquote>
<p>Takes an array, append a 0 then copies itself once more.</p>
<p>This step is necessary to do matrix multiplication with Galois rotations.
This is used on the diagonal vectors.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="HomomorphicModel" class="doc_header"><code>class</code> <code>HomomorphicModel</code><a href="" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>HomomorphicModel</code>()</p>
</blockquote>
<p>Base class for Homormorphic Decision Trees and Random Forest.</p>
<p>As the Homomorphic Evaluator will only need weights, and comparator 
for the Homomorphic Featurizer, a model should only return these two.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="HomomorphicDecisionTree" class="doc_header"><code>class</code> <code>HomomorphicDecisionTree</code><a href="" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>HomomorphicDecisionTree</code>(<strong><code>w0</code></strong>, <strong><code>b0</code></strong>, <strong><code>w1</code></strong>, <strong><code>b1</code></strong>, <strong><code>w2</code></strong>, <strong><code>b2</code></strong>) :: <a href="/cryptotree/cryptotree#HomomorphicModel"><code>HomomorphicModel</code></a></p>
</blockquote>
<p>Homomorphic Decision Tree, which extracts appropriate weights for
homomorphic operations from a Neural Decision Tree.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="HomomorphicNeuralRandomForest" class="doc_header"><code>class</code> <code>HomomorphicNeuralRandomForest</code><a href="" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>HomomorphicNeuralRandomForest</code>(<strong><code>neural_rf</code></strong>:<a href="/cryptotree/tree#NeuralRandomForest"><code>NeuralRandomForest</code></a>) :: <a href="/cryptotree/cryptotree#HomomorphicModel"><code>HomomorphicModel</code></a></p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Homomorphic-evaluator-and-featurizer">Homomorphic evaluator and featurizer<a class="anchor-link" href="#Homomorphic-evaluator-and-featurizer"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now to evaluate our models, we will use an evaluator, which is a general purpose class which will do the computing based on the provided weights.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="HomomorphicTreeEvaluator" class="doc_header"><code>class</code> <code>HomomorphicTreeEvaluator</code><a href="" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>HomomorphicTreeEvaluator</code>(<strong><code>b0</code></strong>:<code>ndarray</code>, <strong><code>w1</code></strong>, <strong><code>b1</code></strong>, <strong><code>w2</code></strong>, <strong><code>b2</code></strong>, <strong><code>activation_coeffs</code></strong>:<code>List</code>[<code>float</code>], <strong><code>polynomial_evaluator</code></strong>:<code>Callable</code>, <strong><code>evaluator</code></strong>:<code>Evaluator</code>, <strong><code>encoder</code></strong>:<code>CKKSEncoder</code>, <strong><code>relin_keys</code></strong>:<code>RelinKeys</code>, <strong><code>galois_keys</code></strong>:<code>GaloisKeys</code>, <strong><code>scale</code></strong>:<code>float</code>)</p>
</blockquote>
<p>Evaluator which will perform homomorphic computation</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="HomomorphicTreeFeaturizer" class="doc_header"><code>class</code> <code>HomomorphicTreeFeaturizer</code><a href="https://github.com/dhuynh95/cryptotree/tree/master/cryptotree/cryptotree.py#L251" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>HomomorphicTreeFeaturizer</code>(<strong><code>comparator</code></strong>:<code>ndarray</code>, <strong><code>encoder</code></strong>:<code>CKKSEncoder</code>, <strong><code>encryptor</code></strong>:<code>Encryptor</code>, <strong><code>scale</code></strong>:<code>float</code>)</p>
</blockquote>
<p>Featurizer used by the client to encode and encrypt data.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Example">Example<a class="anchor-link" href="#Example"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Setup">Setup<a class="anchor-link" href="#Setup"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here we will see an example of Homomorphic trees in action.</p>
<p>First we can have a look at the activation that will be used, which is a polynomial approximation of the sigmoid with a dilatation factor of 16.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">cryptotree.polynomials</span> <span class="kn">import</span> <span class="p">(</span><span class="n">chebyshev_approximation</span><span class="p">,</span> <span class="n">polynomial_approximation_coefficients</span><span class="p">,</span> 
<span class="n">plot_graph_function_approximation</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">torch</span>

<span class="n">dilatation_factor</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">degree</span> <span class="o">=</span> <span class="n">dilatation_factor</span>

<span class="n">p</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">chebyshev_approximation</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">,</span> <span class="n">dilatation_factor</span><span class="o">=</span><span class="n">dilatation_factor</span><span class="p">,</span>
                                              <span class="n">polynomial_degree</span><span class="o">=</span><span class="n">degree</span><span class="p">)</span>
<span class="n">coeffs</span> <span class="o">=</span> <span class="n">polynomial_approximation_coefficients</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">,</span> <span class="n">dilatation_factor</span><span class="o">=</span><span class="n">dilatation_factor</span><span class="p">,</span>
                                              <span class="n">polynomial_degree</span><span class="o">=</span><span class="n">degree</span><span class="p">)</span>
<span class="n">plot_graph_function_approximation</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">,</span> <span class="n">dilatation_factor</span><span class="o">=</span><span class="n">dilatation_factor</span><span class="p">,</span>
                                              <span class="n">polynomial_degree</span><span class="o">=</span><span class="n">degree</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(&lt;Figure size 432x288 with 1 Axes&gt;,
 &lt;matplotlib.axes._subplots.AxesSubplot at 0x7f25cd161af0&gt;)</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we need to set the parameters for CKKS SEAL. We need to know how many bits of precision we need, and how many multiplications will be needed.</p>
<p>Here, because we do two polynomial evaluations, we will need $\lceil log_2(n)\rceil + 1$ per multiplication, with $n$ the degree of the polynomial as we use the tree method, and two multiplications for the matcher and the head.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We will populate our SEAL environment with a helper function using the parameters we have defined. Using the builtins, we will be able to call <em>print_ctx</em> without having to provide the encoder and decryptor.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 
<span class="kn">from</span> <span class="nn">cryptotree.seal_helper</span> <span class="kn">import</span> <span class="n">create_seal_globals</span><span class="p">,</span> <span class="n">append_globals_to_builtins</span>
<span class="kn">import</span> <span class="nn">builtins</span>

<span class="c1"># SEAL parameters</span>
<span class="n">PRECISION_BITS</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">UPPER_BITS</span> <span class="o">=</span> <span class="mi">9</span>

<span class="n">polynomial_multiplications</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">degree</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">n_polynomials</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">matrix_multiplications</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">depth</span> <span class="o">=</span> <span class="n">matrix_multiplications</span> <span class="o">+</span> <span class="n">polynomial_multiplications</span> <span class="o">*</span> <span class="n">n_polynomials</span>

<span class="n">poly_modulus_degree</span> <span class="o">=</span> <span class="mi">16384</span>

<span class="n">moduli</span> <span class="o">=</span> <span class="p">[</span><span class="n">PRECISION_BITS</span> <span class="o">+</span> <span class="n">UPPER_BITS</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">depth</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span><span class="n">PRECISION_BITS</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">PRECISION_BITS</span> <span class="o">+</span> <span class="n">UPPER_BITS</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">moduli</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">moduli</span><span class="p">))</span>

<span class="c1"># Populate the environment with the SEAL context</span>
<span class="n">create_seal_globals</span><span class="p">(</span><span class="nb">globals</span><span class="p">(),</span> <span class="n">poly_modulus_degree</span><span class="p">,</span> <span class="n">moduli</span><span class="p">,</span> <span class="n">PRECISION_BITS</span><span class="p">)</span>
<span class="n">append_globals_to_builtins</span><span class="p">(</span><span class="nb">globals</span><span class="p">(),</span> <span class="n">builtins</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[39, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 39]
438
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next we need to load the dataset.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">cryptotree.tree</span> <span class="kn">import</span> <span class="n">SigmoidTreeMaker</span>

<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">cryptotree.tree</span> <span class="kn">import</span> <span class="n">NeuralRandomForest</span>

<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_iris</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>

<span class="c1"># Data loading</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>

<span class="n">iris</span> <span class="o">=</span> <span class="n">load_iris</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">data</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">target</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Homomorphic-Decisison-tree">Homomorphic Decisison tree<a class="anchor-link" href="#Homomorphic-Decisison-tree"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we will explore the homomorphic counterpart.</p>
<p>To use a Homomorphic Decision Tree, a Neural Tree Maker is needed, here we will use a Sigmoid one.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tree</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">tree</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">tree_maker</span> <span class="o">=</span> <span class="n">SigmoidTreeMaker</span><span class="p">(</span><span class="n">dilatation_factor</span><span class="o">=</span><span class="n">dilatation_factor</span><span class="p">,</span> <span class="n">polynomial_degree</span><span class="o">=</span><span class="n">degree</span><span class="p">,</span> 
                              <span class="n">use_polynomial</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">neural_tree</span> <span class="o">=</span> <span class="n">tree_maker</span><span class="o">.</span><span class="n">make_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we simply need to pass the weights of the Neural Decision Tree to the Homomoprhic Decision Tree.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">htree</span> <span class="o">=</span> <span class="n">HomomorphicDecisionTree</span><span class="p">(</span><span class="o">*</span><span class="n">neural_tree</span><span class="o">.</span><span class="n">return_weights</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can now create an Homomorphic Tree Evaluator, which will take perform the computations.</p>
<p>We also create a featurizer, which will be used in the client side to apply the preprocessing pipeline, the encoding and the encryption of the data.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tree_evaluator</span> <span class="o">=</span> <span class="n">HomomorphicTreeEvaluator</span><span class="o">.</span><span class="n">from_model</span><span class="p">(</span><span class="n">htree</span><span class="p">,</span> <span class="n">tree_maker</span><span class="o">.</span><span class="n">coeffs</span><span class="p">,</span> 
                                                   <span class="n">polyeval_tree</span><span class="p">,</span> <span class="n">evaluator</span><span class="p">,</span> <span class="n">encoder</span><span class="p">,</span> <span class="n">relin_keys</span><span class="p">,</span> <span class="n">galois_keys</span><span class="p">,</span> 
                                                   <span class="n">scale</span><span class="p">)</span>

<span class="n">featurizer</span> <span class="o">=</span> <span class="n">HomomorphicTreeFeaturizer</span><span class="p">(</span><span class="n">htree</span><span class="o">.</span><span class="n">return_comparator</span><span class="p">(),</span> <span class="n">encoder</span><span class="p">,</span> <span class="n">encryptor</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The featurizer will take care of all the preprocessing pipeline, including encoding and encryption and the resulting Ciphertext can be analyzed by the tree evaluator.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ctx</span> <span class="o">=</span> <span class="n">featurizer</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">outputs</span> <span class="o">=</span> <span class="n">tree_evaluator</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Finally, the outputs can be decrypted by the client :</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">:</span>
    <span class="n">ptx</span> <span class="o">=</span> <span class="n">seal</span><span class="o">.</span><span class="n">Plaintext</span><span class="p">()</span>
    <span class="n">decryptor</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">ptx</span><span class="p">)</span>
    
    <span class="n">values</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">decode_double</span><span class="p">(</span><span class="n">ptx</span><span class="p">)</span>
    
    <span class="n">output</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>0.02543640136718763
0.23716735839843653
-0.1674423217773434
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can check that the results of the Homomorphic Decision Tree are similar to the Neural Decision Tree :</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">neural_tree</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([ 0.0373,  0.2490, -0.1505], grad_fn=&lt;AddBackward0&gt;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We notice small rounding errors that come with the noise that increases during computations, but the scores are rather well preserved.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Homomorphic-Random-Forest">Homomorphic Random Forest<a class="anchor-link" href="#Homomorphic-Random-Forest"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The process is similar when using Homomorphic Random Forest, we first need to create a neural counterpart, before feeding it to the Homomorphic Random Forest which will extract the right weights, which will be used by Homomorphic Tree Evaluator.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">tree_maker</span> <span class="o">=</span> <span class="n">SigmoidTreeMaker</span><span class="p">(</span><span class="n">dilatation_factor</span><span class="o">=</span><span class="n">dilatation_factor</span><span class="p">,</span> <span class="n">polynomial_degree</span><span class="o">=</span><span class="n">degree</span><span class="p">,</span> <span class="n">use_polynomial</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">neural_rf</span> <span class="o">=</span> <span class="n">NeuralRandomForest</span><span class="p">(</span><span class="n">rf</span><span class="o">.</span><span class="n">estimators_</span><span class="p">,</span> <span class="n">tree_maker</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The process is exactly the same as before, first we create the Homomorphic Random Forest, before we create the evaluator from its weights, and the featurizer.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">h_rf</span> <span class="o">=</span> <span class="n">HomomorphicNeuralRandomForest</span><span class="p">(</span><span class="n">neural_rf</span><span class="p">)</span>

<span class="n">tree_evaluator</span> <span class="o">=</span> <span class="n">HomomorphicTreeEvaluator</span><span class="o">.</span><span class="n">from_model</span><span class="p">(</span><span class="n">h_rf</span><span class="p">,</span> <span class="n">tree_maker</span><span class="o">.</span><span class="n">coeffs</span><span class="p">,</span> 
                                                   <span class="n">polyeval_tree</span><span class="p">,</span> <span class="n">evaluator</span><span class="p">,</span> <span class="n">encoder</span><span class="p">,</span> <span class="n">relin_keys</span><span class="p">,</span> <span class="n">galois_keys</span><span class="p">,</span> 
                                                   <span class="n">scale</span><span class="p">)</span>

<span class="n">featurizer</span> <span class="o">=</span> <span class="n">HomomorphicTreeFeaturizer</span><span class="p">(</span><span class="n">h_rf</span><span class="o">.</span><span class="n">return_comparator</span><span class="p">(),</span> <span class="n">encoder</span><span class="p">,</span> <span class="n">encryptor</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can now compute the outputs.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ctx</span> <span class="o">=</span> <span class="n">featurizer</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">outputs</span> <span class="o">=</span> <span class="n">tree_evaluator</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Decode it :</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">:</span>
    <span class="n">ptx</span> <span class="o">=</span> <span class="n">seal</span><span class="o">.</span><span class="n">Plaintext</span><span class="p">()</span>
    <span class="n">decryptor</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">ptx</span><span class="p">)</span>
    
    <span class="n">values</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">decode_double</span><span class="p">(</span><span class="n">ptx</span><span class="p">)</span>
    
    <span class="n">output</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>-0.06132507324218763
0.20121765136718736
-0.10980987548828139
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And compare to the Neural Random Forest outputs :</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">neural_rf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([[-0.0568,  0.2032, -0.1049]], grad_fn=&lt;AddBackward0&gt;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

